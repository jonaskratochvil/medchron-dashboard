<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedChron Dashboard - Improved</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
        .status-badge { font-size: 11px; }
        input[type="checkbox"] { cursor: pointer; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback, createContext, useContext } = React;

        // Icons as SVG strings
        const icons = {
            menu: <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fillRule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"/></svg>,
            lightning: <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M11.251.068a.5.5 0 01.227.58L9.677 6.5H13a.5.5 0 01.364.843l-8 8.5a.5.5 0 01-.842-.49L6.323 9.5H3a.5.5 0 01-.364-.843l8-8.5a.5.5 0 01.615-.09z"/></svg>,
            checkCircle: <svg width="32" height="32" fill="none" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="#10b981" strokeWidth="2"/><path stroke="#10b981" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4"/></svg>,
            clock: <svg width="32" height="32" fill="none" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="#3b82f6" strokeWidth="2"/><path stroke="#3b82f6" strokeLinecap="round" strokeWidth="2" d="M12 6v6l4 2"/></svg>,
            hourglass: <svg width="32" height="32" fill="none" viewBox="0 0 24 24"><path stroke="#f59e0b" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 2L12 8M12 16L12 22M4.93 4.93L19.07 19.07M19.07 4.93L4.93 19.07M8 12H16"/></svg>,
            info: <svg width="32" height="32" fill="none" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="#6b7280" strokeWidth="2"/><path stroke="#6b7280" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 16v-4m0-4h.01"/></svg>,
            alertCircle: <svg width="32" height="32" fill="none" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="#a855f7" strokeWidth="2"/><path stroke="#a855f7" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4m0 4h.01"/></svg>,
            search: <svg width="16" height="16" fill="none" viewBox="0 0 20 20"><path stroke="currentColor" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 19l-4-4m0-7A7 7 0 11 1 8a7 7 0 0114 0z"/></svg>,
            refresh: <svg width="16" height="16" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M1 4v6h6M23 20v-6h-6"/><path stroke="currentColor" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 013.51 15"/></svg>,
            chevronLeft: <svg width="16" height="16" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 18l-6-6 6-6"/></svg>,
            chevronRight: <svg width="16" height="16" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 18l6-6-6-6"/></svg>,
            chevronDown: <svg width="12" height="12" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 9l6 6 6-6"/></svg>,
            chevronUp: <svg width="12" height="12" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M18 15l-6-6-6 6"/></svg>,
            folder: <svg width="16" height="16" fill="#f59e0b" viewBox="0 0 20 20"><path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"/></svg>,
            file: <svg width="16" height="16" fill="#ef4444" viewBox="0 0 20 20"><path fillRule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z"/></svg>,
            play: <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"/></svg>,
            user: <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fillRule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"/></svg>,
            bell: <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zm0 16a3 3 0 01-3-3h6a3 3 0 01-3 3z"/></svg>,
            settings: <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fillRule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z"/></svg>,
        };

        // Mock Data
        const users = [
            { id: '1', name: 'Olivia Carter' },
            { id: '2', name: 'Marcus Bennett' },
            { id: '3', name: 'Harper Reed' },
            { id: '4', name: 'System Admin' },
        ];

        const projectNames = [
            'Baker v. Ridgeview Apartments', 'Ramos v. Northgate Superstore',
            'Parker v. Sunrise Daycare Center', 'Flores v. Capital Mall Management',
            'Thompson v. Lakeside School District', 'Mitchell v. Clearview Golf Club',
            'Rivera v. Cascade Transit Authority', 'Grant v. Horizon Delivery Services',
            'Brooks v. Valley Hospital Corporation', 'Dixon v. Elm Street Pharmacy',
            'Anderson v. Metro Tech Solutions', 'Williams v. Central Bank Trust',
            'Johnson v. Premier Medical Group', 'Davis v. Riverside Insurance',
            'Miller v. Northern Electric Coop', 'Wilson v. Southside Community Center',
            'Moore v. Westfield Shopping Mall', 'Taylor v. Highland Construction',
            'Thomas v. Pacific Airways', 'Jackson v. Downtown Hotel Group',
        ];

        function generateStatus() {
            const rand = Math.random();
            if (rand < 0.5) return { kind: 'completed' };
            if (rand < 0.65) {
                const total = Math.floor(Math.random() * 50) + 10;
                const processed = Math.floor(Math.random() * total);
                return { kind: 'in_progress', processed, total };
            }
            if (rand < 0.75) return { kind: 'pending' };
            if (rand < 0.85) return { kind: 'review', pendingCount: Math.floor(Math.random() * 15) + 1 };
            return { kind: 'not_initiated' };
        }

        function generateMockProjects(count = 274) {
            const projects = [];
            for (let i = 0; i < count; i++) {
                const status = generateStatus();
                const hasBeenInitiated = status.kind !== 'not_initiated';
                const user = hasBeenInitiated ? users[Math.floor(Math.random() * users.length)] : null;
                
                projects.push({
                    projectId: `proj-${i + 1}`,
                    projectName: projectNames[i % projectNames.length] + (i >= projectNames.length ? ` (${Math.floor(i / projectNames.length) + 1})` : ''),
                    status,
                    initiatedBy: user,
                    initiatedAt: hasBeenInitiated ? new Date(Date.now() - Math.random() * 180 * 24 * 60 * 60 * 1000).toISOString() : null,
                });
            }
            return projects;
        }

        function generateMockDocuments() {
            const folders = ['Discovery', 'Depositions', 'Disclosures', 'Expert Discovery', 'Interrogatories', 
                            'Medical Records', 'Correspondence', 'Research', 'Evidence', 'Work Product', 'Billing'];
            const docs = [];
            
            folders.forEach((folder, idx) => {
                const folderNode = {
                    docId: `folder-${idx}`,
                    fileName: folder,
                    isFolder: true,
                    included: true,
                    children: []
                };
                
                const count = Math.floor(Math.random() * 5) + 3;
                for (let i = 0; i < count; i++) {
                    const isMedical = folder === 'Medical Records' || Math.random() > 0.7;
                    folderNode.children.push({
                        docId: `doc-${idx}-${i}`,
                        fileName: `Smith_v_MercyHospital_${isMedical ? 'MedicalRecord' : 'Document'}_${i + 1}.pdf`,
                        uploadedBy: users[Math.floor(Math.random() * users.length)].name,
                        included: isMedical
                    });
                }
                docs.push(folderNode);
            });
            
            return docs;
        }

        function getStatusColor(status) {
            switch (status.kind) {
                case 'completed': return 'bg-green-100 text-green-700 border-green-300';
                case 'in_progress': return 'bg-blue-100 text-blue-700 border-blue-300';
                case 'pending': return 'bg-yellow-100 text-yellow-700 border-yellow-300';
                case 'review': return 'bg-purple-100 text-purple-700 border-purple-300';
                case 'not_initiated': return 'bg-gray-100 text-gray-500 border-gray-300';
                default: return 'bg-gray-100 text-gray-500 border-gray-300';
            }
        }

        function getStatusLabel(status) {
            switch (status.kind) {
                case 'completed': return 'Completed';
                case 'in_progress': return `In progress - ${status.processed}%`;
                case 'pending': return 'Pending';
                case 'review': return `Review (${status.pendingCount})`;
                case 'not_initiated': return 'Not initiated';
                default: return 'Unknown';
            }
        }

        function formatDate(dateString) {
            if (!dateString) return '--';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                month: '2-digit', 
                day: '2-digit', 
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
            }).replace(',', '');
        }

        // Context
        const AppContext = createContext();

        function AppProvider({ children }) {
            const [projects, setProjects] = useState(() => generateMockProjects());
            const [selectedProjects, setSelectedProjects] = useState(new Set());
            const [currentView, setCurrentView] = useState('dashboard');
            const [currentProjectId, setCurrentProjectId] = useState(null);

            const updateProjectStatus = useCallback((projectId, status) => {
                setProjects(prev => prev.map(p =>
                    p.projectId === projectId ? { ...p, status } : p
                ));
            }, []);

            const initiateProjects = useCallback((projectIds) => {
                const now = new Date().toISOString();
                setProjects(prev => prev.map(project => {
                    if (projectIds.includes(project.projectId)) {
                        return { ...project, status: { kind: 'pending' }, initiatedAt: now, initiatedBy: { id: 'current', name: 'Current User' } };
                    }
                    return project;
                }));

                projectIds.forEach((projectId, index) => {
                    setTimeout(() => {
                        const total = Math.floor(Math.random() * 30) + 20;
                        updateProjectStatus(projectId, { kind: 'in_progress', processed: 0, total });
                        
                        let progress = 0;
                        const interval = setInterval(() => {
                            progress += Math.floor(Math.random() * 5) + 1;
                            if (progress >= total) {
                                updateProjectStatus(projectId, { kind: 'completed' });
                                clearInterval(interval);
                            } else {
                                updateProjectStatus(projectId, { kind: 'in_progress', processed: Math.round((progress / total) * 100), total });
                            }
                        }, 1000);
                    }, (index + 1) * 2000);
                });
            }, [updateProjectStatus]);

            return (
                <AppContext.Provider value={{
                    projects, selectedProjects, setSelectedProjects,
                    currentView, setCurrentView, currentProjectId, setCurrentProjectId,
                    initiateProjects, updateProjectStatus
                }}>
                    {children}
                </AppContext.Provider>
            );
        }

        // Components
        function Header() {
            return (
                <header className="bg-gray-900 text-white h-14">
                    <div className="flex items-center justify-between h-full px-6">
                        <div className="flex items-center space-x-6">
                            <div className="cursor-pointer">{icons.menu}</div>
                            <nav className="flex items-center space-x-6 text-sm">
                                <div className="flex items-center space-x-2 cursor-pointer">
                                    <span className="text-white">{icons.lightning}</span>
                                    <span>Feed</span>
                                </div>
                                <div className="flex items-center space-x-2 cursor-pointer">
                                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                                        <path fillRule="evenodd" d="M4 5a2 2 0 012-2 1 1 0 000 2H6a2 2 0 00-2 2v6a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-1a1 1 0 100-2h1a4 4 0 014 4v8a4 4 0 01-4 4H6a4 4 0 01-4-4V7a4 4 0 014-4z"/>
                                    </svg>
                                    <span>Tasks</span>
                                </div>
                                <div className="flex items-center space-x-2 cursor-pointer">
                                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zm0 4a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zm0 4a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1z"/>
                                    </svg>
                                    <span>Projects</span>
                                </div>
                                <div className="flex items-center space-x-2 cursor-pointer">
                                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                        <path fillRule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4z"/>
                                    </svg>
                                    <span>Documents</span>
                                </div>
                            </nav>
                        </div>
                        
                        <div className="flex items-center space-x-4">
                            <div className="text-2xl font-bold tracking-wide">Filevine</div>
                            <div className="relative">
                                <span className="absolute left-3 top-2.5 text-gray-400">{icons.search}</span>
                                <input
                                    type="text"
                                    placeholder="Search for a project, contact, tag, etc."
                                    className="bg-gray-800 text-white placeholder-gray-400 pl-10 pr-4 py-2 rounded text-sm w-80 focus:outline-none focus:bg-gray-700"
                                />
                            </div>
                            <div className="cursor-pointer">{icons.bell}</div>
                            <div className="cursor-pointer">{icons.settings}</div>
                            <div className="w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center text-sm font-medium">
                                JK
                            </div>
                            <span className="text-gray-400">{icons.chevronRight}</span>
                        </div>
                    </div>
                </header>
            );
        }

        function StatusBadge({ status }) {
            return (
                <span className={`status-badge inline-flex items-center px-2 py-0.5 rounded border ${getStatusColor(status)}`}>
                    {getStatusLabel(status)}
                </span>
            );
        }

        function Dashboard() {
            const { projects, selectedProjects, setSelectedProjects, setCurrentView, setCurrentProjectId, initiateProjects } = useContext(AppContext);
            const [searchTerm, setSearchTerm] = useState('');
            const [statusFilter, setStatusFilter] = useState(new Set());
            const [currentPage, setCurrentPage] = useState(1);
            const [showConfirmModal, setShowConfirmModal] = useState(false);
            const [sortBy, setSortBy] = useState('initiatedAt');
            const [sortDir, setSortDir] = useState('desc');
            const pageSize = 10;

            const stats = useMemo(() => ({
                completed: projects.filter(p => p.status.kind === 'completed').length,
                inProgress: projects.filter(p => p.status.kind === 'in_progress').length,
                pending: projects.filter(p => p.status.kind === 'pending').length,
                notInitiated: projects.filter(p => p.status.kind === 'not_initiated').length,
                review: projects.filter(p => p.status.kind === 'review').length,
            }), [projects]);

            const filteredProjects = useMemo(() => {
                return projects.filter(project => {
                    const matchesSearch = project.projectName.toLowerCase().includes(searchTerm.toLowerCase());
                    const matchesStatus = statusFilter.size === 0 || statusFilter.has(project.status.kind);
                    return matchesSearch && matchesStatus;
                }).sort((a, b) => {
                    if (sortBy === 'projectName') {
                        return sortDir === 'asc' 
                            ? a.projectName.localeCompare(b.projectName)
                            : b.projectName.localeCompare(a.projectName);
                    }
                    if (sortBy === 'initiatedAt') {
                        const aDate = a.initiatedAt ? new Date(a.initiatedAt).getTime() : 0;
                        const bDate = b.initiatedAt ? new Date(b.initiatedAt).getTime() : 0;
                        return sortDir === 'asc' ? aDate - bDate : bDate - aDate;
                    }
                    return 0;
                });
            }, [projects, searchTerm, statusFilter, sortBy, sortDir]);

            const paginatedProjects = useMemo(() => {
                const startIndex = (currentPage - 1) * pageSize;
                return filteredProjects.slice(startIndex, startIndex + pageSize);
            }, [filteredProjects, currentPage]);

            const totalPages = Math.ceil(filteredProjects.length / pageSize);

            return (
                <div>
                    {/* Advanced Bar */}
                    <div className="bg-white border-b px-6 py-3">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center space-x-2">
                                <span className="font-semibold text-gray-900">Advanced</span>
                            </div>
                            <select className="border border-gray-300 rounded px-3 py-1 text-sm bg-white">
                                <option>Org</option>
                            </select>
                        </div>
                    </div>

                    <div className="flex">
                        {/* Sidebar */}
                        <aside className="w-56 bg-white border-r min-h-screen">
                            <div className="p-4">
                                <div className="mb-4">
                                    <div className="relative">
                                        <span className="absolute left-3 top-2 text-gray-400">{icons.search}</span>
                                        <input
                                            type="text"
                                            placeholder="Filter Menu"
                                            className="w-full pl-10 pr-3 py-1.5 border border-gray-300 rounded text-sm focus:outline-none focus:border-cyan-500"
                                        />
                                    </div>
                                </div>
                                <nav className="space-y-1">
                                    <div className="flex items-center space-x-2 px-3 py-2 bg-cyan-50 text-cyan-600 rounded cursor-pointer">
                                        <div className="w-1.5 h-1.5 bg-cyan-600 rounded-full"></div>
                                        <span className="font-medium text-sm">MedChron Dashboard</span>
                                    </div>
                                </nav>
                            </div>
                        </aside>

                        {/* Main Content */}
                        <main className="flex-1 p-6 bg-gray-50">
                            <h1 className="text-2xl font-bold text-gray-900 mb-6">MedChron Dashboard</h1>
                            
                            {/* Status Cards */}
                            <div className="grid grid-cols-5 gap-4 mb-6">
                                <div className="bg-white rounded-lg border p-4">
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <div className="text-3xl font-bold text-gray-900">{stats.completed}</div>
                                            <div className="text-sm text-gray-600 mt-1">Completed</div>
                                        </div>
                                        {icons.checkCircle}
                                    </div>
                                </div>
                                <div className="bg-white rounded-lg border p-4">
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <div className="text-3xl font-bold text-gray-900">{stats.inProgress}</div>
                                            <div className="text-sm text-gray-600 mt-1">In progress</div>
                                        </div>
                                        {icons.clock}
                                    </div>
                                </div>
                                <div className="bg-white rounded-lg border p-4">
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <div className="text-3xl font-bold text-gray-900">{stats.pending}</div>
                                            <div className="text-sm text-gray-600 mt-1">Pending</div>
                                        </div>
                                        {icons.hourglass}
                                    </div>
                                </div>
                                <div className="bg-white rounded-lg border p-4">
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <div className="text-3xl font-bold text-gray-900">{stats.notInitiated}</div>
                                            <div className="text-sm text-gray-600 mt-1">Not initiated</div>
                                        </div>
                                        {icons.info}
                                    </div>
                                </div>
                                <div className="bg-white rounded-lg border p-4">
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <div className="text-3xl font-bold text-gray-900">{stats.review}</div>
                                            <div className="text-sm text-gray-600 mt-1">Review</div>
                                        </div>
                                        {icons.alertCircle}
                                    </div>
                                </div>
                            </div>

                            {/* Table */}
                            <div className="bg-white rounded-lg border">
                                <div className="p-4 border-b">
                                    <div className="flex items-center justify-between">
                                        <div className="relative flex-1 max-w-md">
                                            <span className="absolute left-3 top-2.5 text-gray-400">{icons.search}</span>
                                            <input
                                                type="text"
                                                placeholder="Search by project name"
                                                value={searchTerm}
                                                onChange={(e) => setSearchTerm(e.target.value)}
                                                className="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-cyan-500"
                                            />
                                        </div>
                                        <div className="flex items-center space-x-2 ml-4">
                                            <button className="p-2 hover:bg-gray-100 rounded">
                                                {icons.refresh}
                                            </button>
                                            {selectedProjects.size > 0 && (
                                                <button
                                                    onClick={() => setShowConfirmModal(true)}
                                                    className="px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 text-sm font-medium"
                                                >
                                                    Initiate ({selectedProjects.size})
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                </div>

                                <table className="w-full">
                                    <thead>
                                        <tr className="bg-gray-50 border-b">
                                            <th className="w-12 px-4 py-3">
                                                <input
                                                    type="checkbox"
                                                    checked={selectedProjects.size === paginatedProjects.length && paginatedProjects.length > 0}
                                                    onChange={() => {
                                                        if (selectedProjects.size === paginatedProjects.length) {
                                                            setSelectedProjects(new Set());
                                                        } else {
                                                            setSelectedProjects(new Set(paginatedProjects.map(p => p.projectId)));
                                                        }
                                                    }}
                                                />
                                            </th>
                                            <th className="px-4 py-3 text-left">
                                                <button 
                                                    onClick={() => {
                                                        if (sortBy === 'projectName') {
                                                            setSortDir(sortDir === 'asc' ? 'desc' : 'asc');
                                                        } else {
                                                            setSortBy('projectName');
                                                            setSortDir('asc');
                                                        }
                                                    }}
                                                    className="flex items-center space-x-1 text-xs font-medium text-gray-600 uppercase tracking-wider"
                                                >
                                                    <span>Project name</span>
                                                    {sortBy === 'projectName' && (sortDir === 'asc' ? icons.chevronUp : icons.chevronDown)}
                                                </button>
                                            </th>
                                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">MedChron status</th>
                                            <th className="px-4 py-3 text-left">
                                                <button 
                                                    onClick={() => {
                                                        if (sortBy === 'initiatedAt') {
                                                            setSortDir(sortDir === 'asc' ? 'desc' : 'asc');
                                                        } else {
                                                            setSortBy('initiatedAt');
                                                            setSortDir('desc');
                                                        }
                                                    }}
                                                    className="flex items-center space-x-1 text-xs font-medium text-gray-600 uppercase tracking-wider"
                                                >
                                                    <span>Initiation date</span>
                                                    {sortBy === 'initiatedAt' && (sortDir === 'asc' ? icons.chevronUp : icons.chevronDown)}
                                                </button>
                                            </th>
                                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Initiated by</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-200">
                                        {paginatedProjects.map((project) => (
                                            <tr key={project.projectId} className="hover:bg-gray-50">
                                                <td className="px-4 py-3">
                                                    <input
                                                        type="checkbox"
                                                        checked={selectedProjects.has(project.projectId)}
                                                        onChange={() => {
                                                            const newSet = new Set(selectedProjects);
                                                            if (newSet.has(project.projectId)) {
                                                                newSet.delete(project.projectId);
                                                            } else {
                                                                newSet.add(project.projectId);
                                                            }
                                                            setSelectedProjects(newSet);
                                                        }}
                                                    />
                                                </td>
                                                <td className="px-4 py-3">
                                                    <button
                                                        onClick={() => {
                                                            setCurrentProjectId(project.projectId);
                                                            setCurrentView('verification');
                                                        }}
                                                        className="text-blue-600 hover:text-blue-800 hover:underline text-sm font-medium"
                                                    >
                                                        {project.projectName}
                                                    </button>
                                                </td>
                                                <td className="px-4 py-3">
                                                    <StatusBadge status={project.status} />
                                                </td>
                                                <td className="px-4 py-3 text-sm text-gray-600">{formatDate(project.initiatedAt)}</td>
                                                <td className="px-4 py-3 text-sm text-gray-600">{project.initiatedBy?.name || '--'}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>

                                {/* Pagination */}
                                <div className="px-4 py-3 border-t flex items-center justify-between bg-white">
                                    <div className="text-sm text-gray-700">
                                        <span className="font-medium">{(currentPage - 1) * pageSize + 1}</span>
                                        <span className="text-gray-500"> to </span>
                                        <span className="font-medium">{Math.min(currentPage * pageSize, filteredProjects.length)}</span>
                                        <span className="text-gray-500"> of </span>
                                        <span className="font-medium">{filteredProjects.length}</span>
                                        <span className="text-gray-500"> MedChrons</span>
                                    </div>
                                    
                                    <div className="flex items-center space-x-2">
                                        <span className="text-sm text-gray-700">Show</span>
                                        <select className="border border-gray-300 rounded px-2 py-1 text-sm">
                                            <option>10</option>
                                            <option>25</option>
                                            <option>50</option>
                                        </select>
                                        
                                        <div className="flex items-center space-x-1">
                                            <button 
                                                onClick={() => setCurrentPage(1)} 
                                                disabled={currentPage === 1}
                                                className="px-2 py-1 text-gray-500 hover:text-gray-700 disabled:opacity-50"
                                            >
                                                «
                                            </button>
                                            <button 
                                                onClick={() => setCurrentPage(Math.max(1, currentPage - 1))} 
                                                disabled={currentPage === 1}
                                                className="px-2 py-1 text-gray-500 hover:text-gray-700 disabled:opacity-50"
                                            >
                                                ‹
                                            </button>
                                            <span className="px-2 text-sm text-gray-700">
                                                Page <span className="font-medium">{currentPage}</span> of <span className="font-medium">{totalPages || 1}</span>
                                            </span>
                                            <button 
                                                onClick={() => setCurrentPage(Math.min(totalPages, currentPage + 1))} 
                                                disabled={currentPage === totalPages}
                                                className="px-2 py-1 text-gray-500 hover:text-gray-700 disabled:opacity-50"
                                            >
                                                ›
                                            </button>
                                            <button 
                                                onClick={() => setCurrentPage(totalPages)} 
                                                disabled={currentPage === totalPages}
                                                className="px-2 py-1 text-gray-500 hover:text-gray-700 disabled:opacity-50"
                                            >
                                                »
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </main>
                    </div>

                    {showConfirmModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white rounded-lg p-6 max-w-md shadow-xl">
                                <h3 className="text-lg font-semibold mb-4">Confirm Bulk Initiation</h3>
                                <p className="text-gray-600 mb-6">
                                    You are about to initiate MedChron for {selectedProjects.size} project{selectedProjects.size > 1 ? 's' : ''}.
                                    This action will process medical documents and may incur costs.
                                </p>
                                <div className="flex space-x-3 justify-end">
                                    <button onClick={() => setShowConfirmModal(false)} className="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                        Cancel
                                    </button>
                                    <button onClick={() => {
                                        initiateProjects(Array.from(selectedProjects));
                                        setSelectedProjects(new Set());
                                        setShowConfirmModal(false);
                                    }} className="px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600">
                                        Initiate MedChron
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        function ProjectVerification() {
            const { projects, currentProjectId, setCurrentView, updateProjectStatus } = useContext(AppContext);
            const [documents, setDocuments] = useState(() => generateMockDocuments());
            const [expandedFolders, setExpandedFolders] = useState(new Set(documents.map(d => d.docId)));
            
            const project = projects.find(p => p.projectId === currentProjectId);
            const includedCount = documents.reduce((sum, folder) => 
                sum + (folder.children?.filter(d => d.included).length || 0), 0);

            const handleRun = () => {
                if (!currentProjectId) return;
                updateProjectStatus(currentProjectId, { kind: 'pending' });
                
                setTimeout(() => {
                    let progress = 0;
                    const total = includedCount;
                    updateProjectStatus(currentProjectId, { kind: 'in_progress', processed: 0, total });
                    
                    const interval = setInterval(() => {
                        progress += Math.floor(Math.random() * 3) + 1;
                        if (progress >= total) {
                            updateProjectStatus(currentProjectId, { kind: 'completed' });
                            clearInterval(interval);
                        } else {
                            updateProjectStatus(currentProjectId, { kind: 'in_progress', processed: Math.round((progress / total) * 100), total });
                        }
                    }, 1000);
                }, 2000);
            };

            return (
                <div className="bg-gray-50 min-h-screen">
                    {/* Breadcrumb */}
                    <div className="bg-white border-b px-6 py-4">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center space-x-3">
                                <button onClick={() => setCurrentView('dashboard')} className="text-gray-600 hover:text-gray-900">
                                    {icons.chevronLeft}
                                </button>
                                <nav className="flex items-center space-x-2 text-sm text-gray-600">
                                    <span>Feed</span>
                                    <span>{icons.chevronRight}</span>
                                    <span>Tasks</span>
                                    <span>{icons.chevronRight}</span>
                                    <span>Project Hub</span>
                                    <span>{icons.chevronRight}</span>
                                    <span>Documents</span>
                                </nav>
                            </div>
                            <div className="flex items-center space-x-2">
                                <button className="px-3 py-1.5 border border-gray-300 rounded text-sm hover:bg-gray-50">Discovery</button>
                                <button className="px-3 py-1.5 bg-cyan-500 text-white rounded text-sm hover:bg-cyan-600">Vitals</button>
                            </div>
                        </div>
                    </div>

                    <div className="p-6">
                        {/* Project Header */}
                        <div className="mb-6 flex items-center justify-between">
                            <div>
                                <h1 className="text-2xl font-bold text-gray-900 mb-2">{project?.projectName}</h1>
                                <div className="flex items-center space-x-3 text-sm">
                                    <span className="text-gray-600">MedChron Status:</span>
                                    {project && <StatusBadge status={project.status} />}
                                </div>
                            </div>
                            {project?.status.kind !== 'in_progress' && (
                                <button onClick={handleRun} disabled={includedCount === 0}
                                    className={`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium text-sm ${
                                        includedCount > 0 ? 'bg-cyan-500 text-white hover:bg-cyan-600' : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                    }`}>
                                    <span className="text-white">{icons.play}</span>
                                    <span>Initiate MedChron</span>
                                </button>
                            )}
                        </div>

                        {/* Progress Bar */}
                        {project?.status.kind === 'in_progress' && (
                            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                                <div className="flex justify-between mb-2">
                                    <span className="text-sm font-medium text-blue-900">Processing Documents</span>
                                    <span className="text-sm text-blue-700">{project.status.processed}% Complete</span>
                                </div>
                                <div className="w-full bg-blue-100 rounded-full h-2">
                                    <div className="bg-blue-500 h-2 rounded-full transition-all duration-300"
                                        style={{ width: `${project.status.processed}%` }} />
                                </div>
                            </div>
                        )}

                        {/* Welcome Section */}
                        <div className="bg-white rounded-lg border">
                            <div className="p-6 border-b">
                                <h2 className="text-xl font-semibold mb-3">Welcome to MedChron by Filevine</h2>
                                <p className="text-sm text-gray-600 mb-4 leading-relaxed">
                                    MedChron uses AI to generate a comprehensive medical chronology based on all relevant 
                                    documents uploaded to this project, helping you quickly understand a patient's treatments, 
                                    diagnoses, and overall medical history.
                                </p>
                                <button className="px-4 py-2 bg-cyan-500 text-white rounded text-sm font-medium hover:bg-cyan-600">
                                    Initiate MedChron
                                </button>
                            </div>

                            <div className="p-6 border-b">
                                <div className="flex items-center justify-between mb-4">
                                    <div>
                                        <h3 className="font-semibold text-gray-900">Source documents</h3>
                                        <p className="text-sm text-gray-600 mt-1">
                                            {includedCount} documents from this project will be included as sources to initiate MedChron
                                        </p>
                                    </div>
                                    <button className="flex items-center space-x-1 px-3 py-1.5 text-sm text-cyan-600 border border-cyan-500 rounded hover:bg-cyan-50">
                                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                            <path fillRule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"/>
                                        </svg>
                                        <span>Add documents</span>
                                    </button>
                                </div>

                                <div className="text-sm text-gray-600">
                                    All statuses ▼ &nbsp;&nbsp; Collapse folders ↕
                                </div>
                            </div>

                            {/* Document Tree */}
                            <div className="divide-y">
                                {documents.map((folder) => (
                                    <div key={folder.docId}>
                                        <div 
                                            className="flex items-center px-6 py-3 hover:bg-gray-50 cursor-pointer"
                                            onClick={() => {
                                                const newSet = new Set(expandedFolders);
                                                if (newSet.has(folder.docId)) newSet.delete(folder.docId);
                                                else newSet.add(folder.docId);
                                                setExpandedFolders(newSet);
                                            }}
                                        >
                                            <span className="mr-2 text-gray-400">
                                                {expandedFolders.has(folder.docId) ? icons.chevronDown : icons.chevronRight}
                                            </span>
                                            <span className="mr-2">{icons.folder}</span>
                                            <span className="font-medium text-sm">{folder.fileName}</span>
                                        </div>
                                        
                                        {expandedFolders.has(folder.docId) && folder.children && (
                                            <div className="bg-gray-50">
                                                {folder.children.map((doc) => (
                                                    <div key={doc.docId} className="flex items-center px-12 py-2 hover:bg-gray-100">
                                                        <input 
                                                            type="checkbox" 
                                                            checked={doc.included}
                                                            onChange={() => {
                                                                setDocuments(prev => prev.map(f => ({
                                                                    ...f,
                                                                    children: f.children?.map(d => 
                                                                        d.docId === doc.docId ? { ...d, included: !d.included } : d
                                                                    )
                                                                })));
                                                            }}
                                                            className="mr-3"
                                                        />
                                                        <span className="mr-2">{icons.file}</span>
                                                        <div className="flex-1 min-w-0">
                                                            <div className="text-sm font-medium truncate">{doc.fileName}</div>
                                                        </div>
                                                        <span className={`text-xs font-medium px-2 ${
                                                            doc.included ? 'text-green-600' : 'text-gray-400'
                                                        }`}>
                                                            {doc.included ? '✓ Included' : '✗ Excluded'}
                                                        </span>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>

                            <div className="px-6 py-4 bg-gray-50 border-t text-sm text-gray-600">
                                {includedCount} documents from this project will be included as sources to initiate MedChron
                                <button className="float-right text-cyan-600 hover:text-cyan-700 font-medium">
                                    + Add documents
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function App() {
            const { currentView } = useContext(AppContext);
            
            return (
                <div className="min-h-screen">
                    <Header />
                    {currentView === 'dashboard' ? <Dashboard /> : <ProjectVerification />}
                </div>
            );
        }

        function Root() {
            return (
                <AppProvider>
                    <App />
                </AppProvider>
            );
        }

        ReactDOM.render(<Root />, document.getElementById('root'));
    </script>
</body>
</html>